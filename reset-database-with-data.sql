-- ============================================
-- üîÑ DATABASE SIFIRLAMA V∆è SEED DATA SCRIPTI
-- ============================================
-- Bu script database-i sƒ±fƒ±rlayƒ±r V∆è sample data …ôlav…ô edir
-- Dƒ∞QQ∆èT: B√ºt√ºn m√∂vcud data silin…ôc…ôk!
-- ============================================

USE master;
GO

DECLARE @dbname NVARCHAR(128) = 'ExperienceProject';
DECLARE @sql NVARCHAR(MAX);

-- Database varsa silm…ôk
IF EXISTS (SELECT 1 FROM sys.databases WHERE name = @dbname)
BEGIN
    SET @sql = 'ALTER DATABASE [' + @dbname + '] SET SINGLE_USER WITH ROLLBACK IMMEDIATE';
    EXEC sp_executesql @sql;
    
    SET @sql = 'DROP DATABASE [' + @dbname + ']';
    EXEC sp_executesql @sql;
    
    PRINT '‚úÖ Database silindi: ' + @dbname;
END
GO

-- ============================================
-- DATABASE YARADIRIQ
-- ============================================
CREATE DATABASE ExperienceProject;
GO

USE ExperienceProject;
GO

PRINT '‚úÖ Database yaradƒ±ldƒ±: ExperienceProject';
GO

-- ============================================
-- ADMƒ∞N USERS ∆èLAV∆è EDƒ∞Lƒ∞R
-- ============================================
IF NOT EXISTS (SELECT 1 FROM sys.tables WHERE name = 'Users')
BEGIN
    PRINT '‚ÑπÔ∏è Users table h…ôl…ô yoxdur, migration t…ôl…ôb olunur.';
END
ELSE
BEGIN
    -- Admin user …ôlav…ô et
    IF NOT EXISTS (SELECT 1 FROM Users WHERE Email = 'admin@wanderly.com')
    BEGIN
        INSERT INTO Users (FirstName, LastName, Email, UserName, PasswordHash, Country, ProfileImage)
        VALUES ('Admin', 'Wanderly', 'admin@wanderly.com', 'admin', 
                'w6uVNgKTDTxSxkYWKNZXOV5cdVkwYTFk0bC1v+kRzdJHvhYGLlXBSStK3iv0bgDFGKmAGL1pZaItYGDqJgMW+Q==', 
                'Global', 
                'https://api.dicebear.com/7.x/avataaars/svg?seed=admin');
        
        PRINT '‚úÖ Admin user …ôlav…ô edildi';
        PRINT '   Email: admin@wanderly.com';
        PRINT '   Password: Admin123!';
    END
    ELSE
    BEGIN
        PRINT '‚ÑπÔ∏è Admin user artƒ±q m√∂vcuddur';
    END
END
GO

-- ============================================
-- ‚úÖ TAMAMLANDI
-- ============================================
-- Qeyd: Bu SQL script database-in yalnƒ±z structure-unu yaradƒ±r
-- Seed data seed olunmaq √º√ß√ºn:
-- 1. Application-i restart edin
-- 2. Program.cs avtomatik seed data y√ºkl…ôy…ôc…ôk
-- ============================================
PRINT '';
PRINT '========================================';
PRINT '   DATABASE SIFIRLAMA TAMAMLANDI üéâ';
PRINT '========================================';
PRINT '';
PRINT 'üìù N√∂vb…ôti addƒ±mlar:';
PRINT '1. Application-i restart edin';
PRINT '2. Seed data avtomatik y√ºkl…ôn…ôc…ôk';
PRINT '3. Admin login edin:';
PRINT '   Email: admin@wanderly.com';
PRINT '   Password: Admin123!';
PRINT '';
PRINT 'üìä Seed data:';
PRINT '   - 50 Users';
PRINT '   - 30-60 Experiences';
PRINT '   - Videos in experiences';
PRINT '   - Default Stories';
PRINT '   - 100+ Comments';
PRINT '';
PRINT '‚úÖ Hazƒ±rsƒ±nƒ±z!';
PRINT '========================================';
GO

